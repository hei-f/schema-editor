#!/bin/bash

echo "ðŸš€ å¯åŠ¨ Schema Editor æµ‹è¯•çŽ¯å¢ƒ"
echo "================================"
echo ""

# æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•
if [ ! -f "../package.json" ]; then
    echo "âŒ é”™è¯¯ï¼šè¯·åœ¨ test ç›®å½•ä¸­è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# å¯åŠ¨æ’ä»¶å¼€å‘æœåŠ¡å™¨
echo "ðŸ“¦ å¯åŠ¨æ’ä»¶å¼€å‘æœåŠ¡å™¨..."
cd ..
tnpm run dev &
DEV_PID=$!
cd test

# ç­‰å¾…å¼€å‘æœåŠ¡å™¨å¯åŠ¨
sleep 5

# å¯åŠ¨æµ‹è¯•é¡µé¢HTTPæœåŠ¡å™¨
echo "ðŸŒ å¯åŠ¨æµ‹è¯•é¡µé¢æœåŠ¡å™¨ï¼ˆç«¯å£8080ï¼‰..."
python3 -m http.server 8080 &
HTTP_PID=$!

echo ""
echo "âœ… æ‰€æœ‰æœåŠ¡å™¨å·²å¯åŠ¨ï¼"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸ“ æµ‹è¯•é¡µé¢: http://localhost:8080/index.html"
echo "ðŸ“ æ’ä»¶ç›®å½•: $(pwd)/../dist"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ðŸ“– ä¸‹ä¸€æ­¥ï¼š"
echo "  1. åœ¨Chromeä¸­åŠ è½½æ‰©å±•ï¼šchrome://extensions/"
echo "  2. å¼€å¯å¼€å‘è€…æ¨¡å¼ï¼ŒåŠ è½½ dist ç›®å½•"
echo "  3. è®¿é—®æµ‹è¯•é¡µé¢å¹¶å¼€å§‹æµ‹è¯•"
echo ""
echo "âš ï¸  æŒ‰ Ctrl+C åœæ­¢æ‰€æœ‰æœåŠ¡å™¨"
echo ""

# ç­‰å¾…ç”¨æˆ·ä¸­æ–­
trap "echo ''; echo 'ðŸ›‘ åœæ­¢æœåŠ¡å™¨...'; kill $DEV_PID $HTTP_PID 2>/dev/null; exit" INT TERM

wait

