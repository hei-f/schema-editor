---
alwaysApply: false
---

# Chrome插件发布流程

这是一个chrome插件项目，其代码托管在github上。

当用户说'执行发布流程'或者类似的命令时，你需要执行项目的发布流程。

## 发布流程步骤

### 1. 前置检查
- 检查git工作区状态（`git status`）
- 确认是否有未提交的改动，如有则在后续步骤中进行原子化提交

### 2. 版本更新确认
向用户确认本次发布是否需要更新插件版本：
- **需要更新**：询问版本类型（major/minor/patch）
- **不需要更新**：跳过版本相关步骤，直接进入构建流程

### 3. 更新版本号（如需要）
同时更新以下文件中的版本号：
- `package.json` 中的 `version` 字段
- `src/manifest.json` 中的 `version` 字段
- `src/options/OptionsApp.tsx` 中的版本号显示（搜索 `<VersionTag>v` 并更新版本号）
- 版本号格式：`major.minor.patch`（如 `1.2.3`）

### 4. 检查README文档更新
根据本次提交的改动内容，判断是否需要更新README文档：
- **需要更新的情况**：
  - 新增功能或移除功能
  - 修改了用户使用方式或配置方法
  - 更改了安装步骤或依赖要求
  - 修复了影响用户体验的重要问题
  - 更新了API或接口
- **检查要点**：
  - 功能介绍是否需要补充或修改
  - 使用说明是否需要更新
  - 截图或示例是否需要更换
- **操作**：
  - 向用户确认是否需要更新README
  - 如需要，帮助用户修改README
  - 等待用户完成对README修改的确认后继续后续流程
  - 注：README更新会在步骤7中作为独立的 `docs:` 类型提交

### 5. 构建打包并生成压缩包
执行打包命令：`tnpm run package`
- 该命令会自动清理旧的dist目录、重新构建并生成zip包
- 打包失败则终止流程，提示用户检查错误

### 6. 验证产物
检查生成的zip包是否存在且大小合理

### 7. 分析并原子化提交改动

**7.1 分析工作区改动**
- 使用 `git status` 查看所有未提交的文件
- 使用 `git diff` 分析具体改动内容
- 识别改动类型（新功能、bug修复、代码重构、性能优化、文档更新等）

**7.2 原子化分组**
将所有改动按照**原子化提交原则**进行分组：
- **原子化标准**：每组改动应聚焦于单一具体功能或改动点
  - 一个功能点的所有相关文件归为一组
  - 一个bug修复的所有相关文件归为一组
  - 一类相关的代码优化归为一组
  - 避免在一个提交中混合不相关的改动
- **版本号文件单独处理**：如果有版本更新，将版本号相关文件（package.json, src/manifest.json, src/options/OptionsApp.tsx）单独作为最后一组

**7.3 逐组提交**
按分组顺序，依次提交每组改动：

对于每组改动：
1. **生成commit message**，遵循以下规范：
   - **质量要求**：必须清晰概括改动内容，让人一眼看懂做了什么
   - **格式**：`{类型前缀}: {具体改动描述}`
   - **类型前缀**：
     - `feat:` 新增功能
     - `fix:` 修复问题
     - `refactor:` 代码重构（不改变功能）
     - `perf:` 性能优化
     - `docs:` 文档更新
     - `style:` 代码格式调整（不影响逻辑）
     - `test:` 测试相关
     - `chore:` 其他杂项（如构建配置、依赖更新等）
   - **描述要求**：
     - 使用有意义的动词描述具体行为（如：添加、修复、优化、重构）
     - 包含改动的核心要点，避免模糊描述
     - 示例：`fix: 修复用户登录验证逻辑` 而非 `update code`

2. **执行提交**：
   - `git add {该组所有相关文件}`
   - `git commit -m "{message}"`

**7.4 版本号提交（仅版本更新时）**
如果本次发布有版本更新，单独提交版本号文件：
- `git add package.json src/manifest.json src/options/OptionsApp.tsx`
- `git commit -m "chore: release v{版本号}"`

**7.5 推送到远程**
所有提交完成后，执行：`git push`

### 8. 创建并推送Tag（仅版本更新时）
- Tag命名格式：`v{版本号}`（如 `v1.2.3`）
- 创建tag：`git tag v{版本号}`
- 推送tag：`git push origin v{版本号}`

### 9. 生成Release内容（仅版本更新时）
生成适用于GitHub Release的内容：
- **Title格式**：`v{版本号}`
- **Description要求**：
  - 简洁明了，只概括核心改动点
  - 使用列表形式，每项一行
  - 分类展示（如：新增功能、问题修复、性能优化等）
  - 避免冗余描述和技术细节

### 10. 发布总结
向用户展示：
- 本次发布的版本号（如有）
- 改动摘要
- 生成的产物路径
- 下一步操作建议（如：手动上传zip到Chrome Web Store）

## 错误处理
任何步骤失败时：
1. 立即停止后续流程
2. 清晰告知失败的步骤和原因
3. 提供可能的解决建议
4. 等待用户处理后再继续
